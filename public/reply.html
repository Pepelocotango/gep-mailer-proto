<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Obrint client de correu...</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
      background: #f3f4f6;
      color: #1f2937;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 2rem 2.5rem;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 420px;
      width: 90%;
    }
    .icon { font-size: 3rem; margin-bottom: 1rem; }
    h1 { font-size: 1.2rem; margin: 0 0 0.5rem; }
    p  { font-size: 0.9rem; color: #6b7280; margin: 0 0 1.5rem; }
    a.btn {
      display: inline-block;
      padding: 0.6rem 1.4rem;
      background: #3b82f6;
      color: white;
      border-radius: 8px;
      text-decoration: none;
      font-size: 0.9rem;
    }
    a.btn:hover { background: #2563eb; }
    hr { margin: 1.5rem 0; }
    .help { text-align: left; }
    .help-title { 
      font-weight: bold; 
      color: #374151; 
      margin-bottom: 0.5rem;
      text-align: center;
    }
    .help-text { 
      font-size: 0.85rem; 
      color: #6b7280; 
      margin-bottom: 1rem; 
    }
    .help-block { 
      background: #f9fafb; 
      border: 1px solid #e5e7eb;
      border-radius: 8px; 
      padding: 1rem; 
      margin-bottom: 1rem; 
    }
    .browser-label { 
      display: flex; 
      align-items: center; 
      gap: 6px; 
      margin-bottom: 0.5rem; 
    }
    ol { 
      margin: 0; 
      padding-left: 1.2rem; 
      font-size: 0.85rem; 
      color: #374151; 
    }
    ol li { margin-bottom: 0.3rem; }
    .tip { 
      margin-top: 0.75rem; 
      font-size: 0.8rem; 
      color: #6b7280; 
      background: #fffbeb; 
      border: 1px solid #fde68a;
      border-radius: 6px; 
      padding: 0.5rem 0.75rem; 
    }
    a { color: #3b82f6; }
  </style>
</head>
<body>
  <div class="card">
    <div class="icon">‚úâÔ∏è</div>
    <h1>Obrint el teu client de correu...</h1>
    <p>Fes clic al bot√≥ per respondre amb el teu gestor de correu:</p>
    <a class="btn" id="mailto-btn" href="#">Obrir client de correu</a>

    <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid #e5e7eb;" />

    <div class="help">
      <p class="help-title">‚öôÔ∏è Si el bot√≥ no funciona</p>
      <p class="help-text">
        Si uses <strong>Gmail al navegador</strong>, pots activar-lo com a gestor de correu 
        una sola vegada i el bot√≥ funcionar√† sempre.
      </p>

      <div class="help-block">
        <div class="browser-label">
          <img src="https://www.google.com/favicon.ico" width="16" height="16" alt="Chrome" />
          <strong>Chrome</strong>
        </div>
        <ol>
          <li>Obre <a href="https://gmail.com" target="_blank">gmail.com</a></li>
          <li>Busca a la barra d'adreces, a la dreta, la icona dels <strong>dos rombos ‚óà</strong> (o un rombe simple ‚óá)</li>
          <li>Clica-la ‚Üí selecciona <em>"Permet que gmail.com gestioni els links de correu (mailto)"</em></li>
          <li>Clica <strong>Permet</strong></li>
        </ol>
        <div class="tip">
          üí° Si no veus la icona, busca la icona de <strong>sliders ‚äû</strong> o un <strong>cercle amb una i</strong> üõà a l'esquerra de la URL
        </div>
      </div>

      <div class="help-block">
        <div class="browser-label">
          <img src="https://www.mozilla.org/favicon.ico" width="16" height="16" alt="Firefox" />
          <strong>Firefox</strong>
        </div>
        <ol>
          <li>Obre <a href="https://gmail.com" target="_blank">gmail.com</a></li>
          <li>Firefox mostrar√† autom√†ticament una notificaci√≥ a la part superior</li>
          <li>Selecciona <em>"Utilitza Gmail"</em> i clica <strong>Permet</strong></li>
        </ol>
      </div>

      <div class="help-block">
        <div class="browser-label">
          <strong>üß≠ Safari (Mac)</strong>
        </div>
        <ol>
          <li>Obre el men√∫ <strong>Safari ‚Üí Prefer√®ncies ‚Üí General</strong></li>
          <li>A "App de correu predeterminada", selecciona <strong>Gmail</strong> (si apareix) o <strong>Apple Mail</strong></li>
          <li>Si no apareix Gmail, necessitar√†s instal¬∑lar l'extensi√≥ <a href="https://apps.apple.com/app/mailto-gmail/id1534924022" target="_blank">Mailto: Gmail</a> de l'App Store</li>
        </ol>
        <div class="tip">
          üí° Safari √©s el navegador m√©s restrictiu amb mailto: ‚Äî Apple Mail com a predeterminat √©s la soluci√≥ m√©s senzilla
        </div>
      </div>

      <div class="help-block">
        <div class="browser-label">
          <img src="https://www.microsoft.com/favicon.ico" width="16" height="16" alt="Edge" />
          <strong>Edge</strong>
        </div>
        <ol>
          <li>Obre <a href="https://gmail.com" target="_blank">gmail.com</a></li>
          <li>A la barra d'adreces, clica la icona de <strong>permisos del lloc</strong> üîí (a l'esquerra de la URL)</li>
          <li>Busca <em>"Gestors de protocols"</em> ‚Üí activa Gmail per a mailto</li>
          <li>O ves a <strong>Configuraci√≥ Edge ‚Üí Cookies i permisos ‚Üí Gestors de protocols</strong></li>
        </ol>
      </div>

      <div class="help-block">
        <div class="browser-label">
          <strong>üì± M√≤bil (Android / iPhone)</strong>
        </div>
        <ol>
          <li>Al m√≤bil el bot√≥ obre directament l'app de correu predeterminada</li>
          <li>Si no funciona, comprova que tens una app de correu instal¬∑lada (Gmail, Outlook...)</li>
          <li>A <strong>Android</strong>: Configuraci√≥ ‚Üí Apps ‚Üí Apps predeterminades ‚Üí App de correu</li>
          <li>A <strong>iPhone</strong>: Configuraci√≥ ‚Üí Mail ‚Üí App de correu predeterminada</li>
        </ol>
      </div>

      <div class="help-block">
        <div class="browser-label">
          <strong>ü¶Å Brave</strong>
        </div>
        <ol>
          <li>Obre <a href="https://gmail.com" target="_blank">gmail.com</a></li>
          <li>A la barra d'adreces, clica la icona del <strong>lle√≥</strong> o els <strong>sliders ‚äû</strong></li>
          <li>Funciona igual que Chrome ‚Äî busca <em>"Gestors de protocols"</em> i permet Gmail per a mailto</li>
        </ol>
        <div class="tip">
          üí° Brave √©s basat en Chrome ‚Äî les instruccions de Chrome funcionen aqu√≠
        </div>
      </div>

      <div class="help-block">
        <div class="browser-label">
          <strong>ü¶Ü DuckDuckGo</strong>
        </div>
        <ol>
          <li>DuckDuckGo (m√≤bil) no suporta gestors de mailto personalitzats</li>
          <li>Obre el link amb Chrome o Safari i segueix les instruccions d'aquell navegador</li>
        </ol>
        <div class="tip">
          üí° DuckDuckGo al m√≤bil √©s molt restrictiu ‚Äî recomanem usar Chrome o Firefox per a aquesta acci√≥
        </div>
      </div>

      <div class="help-block">
        <div class="browser-label">
          <strong>ü¶ä LibreWolf</strong>
        </div>
        <ol>
          <li>Obre <a href="https://gmail.com" target="_blank">gmail.com</a></li>
          <li>LibreWolf √©s basat en Firefox per√≤ amb privacitat refor√ßada ‚Äî pot bloquejar els gestors de protocols per defecte</li>
          <li>Ves a <strong>about:config</strong> ‚Üí busca <code>network.protocol-handler.expose.mailto</code> ‚Üí posa-ho a <strong>false</strong></li>
          <li>Reinicia el navegador i torna a <a href="https://gmail.com" target="_blank">gmail.com</a> ‚Äî ara hauria d'apar√®ixer la notificaci√≥</li>
        </ol>
        <div class="tip">
          üí° LibreWolf √©s el navegador m√©s restrictiu d'aquesta llista ‚Äî si tens problemes, Firefox √©s l'alternativa m√©s compatible
        </div>
      </div>

      <div class="help-block">
        <div class="browser-label">
          <strong>üåä Vivaldi / Opera / Arc</strong>
        </div>
        <ol>
          <li>Tots estan basats en Chrome ‚Äî segueix les instruccions de <strong>Chrome</strong> de dalt</li>
          <li>La icona pot variar per√≤ la configuraci√≥ de gestors de protocols √©s la mateixa</li>
        </ol>
      </div>

      <p class="help-text" style="margin-top:1rem;">
        Un cop fet, torna aqu√≠ i clica el bot√≥ de dalt. ‚úÖ
      </p>

      <hr style="margin: 1.5rem 0; border: none; border-top: 1px solid #e5e7eb;" />

      <div class="help-block" style="background: #fef2f2; border-color: #fecaca;">
        <div class="browser-label">
          <strong>üìß Si res no funciona ‚Äî resposta manual</strong>
        </div>
        <p style="font-size: 0.85rem; color: #374151; margin: 0 0 0.75rem;">
          Obre el teu correu i envia un missatge nou amb aquestes dades:
        </p>
        <div id="manual-info" style="background: white; border: 1px solid #e5e7eb; border-radius: 6px; padding: 0.75rem; font-size: 0.85rem; color: #374151;">
          <p style="margin: 0 0 0.3rem;"><strong>Per a:</strong> <span id="manual-to"></span></p>
          <p style="margin: 0 0 0.3rem;"><strong>Assumpte:</strong> <span id="manual-subject"></span></p>
          <p style="margin: 0;"><strong>Cos:</strong> <span id="manual-body"></span></p>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);

      const to      = params.get('to')      || '';
      const type    = params.get('type')    || '';
      const event   = params.get('event')   || '';
      const worker  = params.get('worker')  || '';
      const date    = params.get('date')    || '';

      const enc = encodeURIComponent;

      let subject = '';
      let body    = '';

      if (type === 'yes') {
        subject = `CONFIRMAT: ${event} - ${worker}`;
        body    = `Hola,\n\nConfirmo la meva assist√®ncia per a l'esdeveniment ${event} (${date}).\n\nSalutacions,\n${worker}`;
      } else if (type === 'no') {
        subject = `NO DISPONIBLE: ${event} - ${worker}`;
        body    = `Hola,\n\nEm sap greu, per√≤ no tinc disponibilitat per a l'esdeveniment ${event} (${date}).\n\nSalutacions,\n${worker}`;
      } else if (type === 'partial') {
        subject = `DISPONIBILITAT PARCIAL: ${event} - ${worker}`;
        body    = `Hola,\n\nPuc assistir a l'esdeveniment ${event}, per√≤ nom√©s els seg√ºents dies:\n\n\n\nSalutacions,\n${worker}`;
      } else if (type === 'pending') {
        subject = `PENDENT: ${event} - ${worker}`;
        body    = `Hola,\n\nEncara no ho s√© segur. T'informar√© el m√©s aviat possible.\n\nSalutacions,\n${worker}`;
      }

      // Emplena la info per a resposta manual
      document.getElementById('manual-to').textContent = to;
      document.getElementById('manual-subject').textContent = subject;
      document.getElementById('manual-body').textContent = 
        body.replace(/\\n/g, ' ¬∑ ');

      const mailtoUrl = `mailto:${to}?subject=${enc(subject)}&body=${enc(body)}`;

      const btn = document.getElementById('mailto-btn');
      btn.href = mailtoUrl;

      // Redirecci√≥ autom√†tica
      window.location.href = mailtoUrl;
    })();
  </script>
</body>
</html>
